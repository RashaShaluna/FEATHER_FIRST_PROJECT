<%- include('../layouts/checkouttopbar')  %>
<style>
       .icon-three-dots-vertical::before {
        content: '\22EE';
        font-size: 1.5rem;
    }

    .dropdown-menu {
        min-width: auto;
        border: 1px solid #ced4da;
        box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
    }
    
    .dropdown {
        position: absolute;
        top: 10px;
        left: 600px;
        color: #1cc0a0;
    }
 
    .card-dashboard {
        position: relative;
        width: 660px;
        height: 100px;
        border: 1px solid #ddd;
        margin-bottom: 15px;
        margin-left: 40px;
    }

    .card-body {
        padding: 15px;
    }

    .btn-link {
        text-decoration: none;
        color: #333;
        padding: 0;
        background: none;
        border: none;
    }

    .btn-primary {
        background-color: #1cc0a0;
        border-color: #1cc0a0;
    }
   
   .card-add {
       margin-bottom: 15px;
       border: 1px solid #ddd; 
       height: 50px;
       background: #fafafa;
   }
   .address-name {
        font-weight: bold;
        font-size: 1.2rem;
    }

    .address-details {
        font-size: 1.3rem;
    }

/* Change the color of the selected radio button */
input[type="radio"]:checked {
    accent-color: grey; /* Choose your desired color */
    }


   @media (max-width: 768px) {
       .card-dashboard {
          width: 450px;
       }

       .card-add {
           width: 400px;
       }
   }

.modal-dialog {
    max-width: 750px; /* Adjust as needed */
}

/* Optional: Center modal content vertically */
.modal-content {
    border-radius: 8px; /* Optional rounded corners */
}
/* .modal-body {
    padding: 20px; /* Add padding around the modal content *
} */

/* .modal-body .row {
    margin-bottom: 15px; 
} */

.form-control {
    width: 90%; /* Adjust input width */
     /* Center the input fields */
}

</style>
<body>

        <main class="main">
        	
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                 <div class="breadcrumb" style="display: flex; justify-content: center; font-size: 24px; color: black;">Checkout Details</div>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="checkout">
	                <div class="container">
            			<div class="checkout-discount">
            				<form action="#">
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
            			</div><!-- End .checkout-discount -->
<form action="#" method="get"> <!-- Set action to your checkout route -->
    <div class="row">
        <div class="col-lg-9">
            <p style="margin-left: 10px; ">Choose Delivery Address</p>
            <% if (addresses && addresses.length > 0) { %>
                <% addresses.forEach((address, index) => { %>
                <div class="card card-dashboard mt-2">
                    <div class="card-body d-flex justify-content-between align-items-start p-4">
                        <!-- Radio Button -->
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectedAddress" id="addressRadio<%= index %>" value="<%= address._id %>" <%= index === 0 ? 'checked' : '' %>>
                            <label class="form-check-label" for="addressRadio<%= index %>">
                                <div class="address-details ml-4">
                                    <div class="address-name">
                                        <%= address.name %> - <%= address.phone %>
                                    </div>
                                    <div>
                                        <%= address.locality %>, <%= address.district %>, <%= address.address %>, <%= address.state %>, <%= address.pincode %>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <!-- Edit Link -->
                        <div class="dropdown">
                            <a style="color: #1cc0a0;" href="#"  data-toggle="modal" data-target="#form"
                            data-name="<%= address.name %>" 
                            data-phone="<%= address.phone %>" 
                            data-locality="<%= address.locality %>" 
                            data-district="<%= address.district %>" 
                            data-address="<%= address.address %>" 
                            data-state="<%= address.state %>" 
                            data-pincode="<%= address.pincode %>" 
                            data-alternate-phone="<%= address.alternatePhone %>" 
                            data-landmark="<%= address.landmark %>">Edit</a>
                        </div>
                    </div>
                </div>
                <!-- modal -->
                <div class="modal fade" id="form" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header border-bottom-0">
                                <h5 class="modal-title" id="exampleModalLabel">Edit Address</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form id="editAddressForm" action="/checkout/editAddress/<%= address._id %>" method="POST">
                                <input type="hidden" name="addressId" value="<%= address._id %>">
                                <div class="modal-body p-4"> <!-- Added padding to modal body -->
                                    <div class="row "> <!-- Added margin bottom to row -->
                                        <div class="col-sm-6">
                                            <label for="name">Name*</label>
                                            <input type="text" name="name" id="name" class="form-control" style="width: 90%;"> <!-- Decreased width -->
                                            <div id="error1" class="error-message"></div>
                                        </div>
                                        <div class="col-sm-6">
                                            <label for="phone">Phone Number*</label>
                                            <input type="text" name="phone" id="phone" class="form-control" style="width: 90%;"> <!-- Decreased width -->
                                            <div id="error2" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-sm-6">
                                            <label for="locality">Locality*</label>
                                            <input type="text" name="locality" id="locality" class="form-control" style="width: 90%;">
                                            <div id="error3" class="error-message"></div>
                                        </div>
                                        <div class="col-sm-6">
                                            <label for="district">District*</label>
                                            <input type="text" name="district" id="district" class="form-control" style="width: 90%;">
                                            <div id="error4" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-sm-12">
                                            <label for="address">Address*</label>
                                            <input type="text" name="address" id="address" class="form-control" style="width: 90%;">
                                            <div id="error5" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-sm-6">
                                            <label for="state">State*</label>
                                            <select name="state" id="state" class="form-control" style="width: 90%;">
                                                <option value="">Select State</option>
                                                <option value="Andhra Pradesh" <%= address.state === 'Andhra Pradesh' ? 'selected' : '' %>>Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh" <%= address.state === 'Arunachal Pradesh' ? 'selected' : '' %>>Arunachal Pradesh</option>
                                                <option value="Assam" <%= address.state === 'Assam' ? 'selected' : '' %>>Assam</option>
                                                <option value="Bihar" <%= address.state === 'Bihar' ? 'selected' : '' %>>Bihar</option>
                                                <option value="Chhattisgarh" <%= address.state === 'Chhattisgarh' ? 'selected' : '' %>>Chhattisgarh</option>
                                                <option value="Goa" <%= address.state === 'Goa' ? 'selected' : '' %>>Goa</option>
                                                <option value="Gujarat" <%= address.state === 'Gujarat' ? 'selected' : '' %>>Gujarat</option>
                                                <option value="Haryana" <%= address.state === 'Haryana' ? 'selected' : '' %>>Haryana</option>
                                                <option value="Himachal Pradesh" <%= address.state === 'Himachal Pradesh' ? 'selected' : '' %>>Himachal Pradesh</option>
                                                <option value="Jammu and Kashmir" <%= address.state === 'Jammu and Kashmir' ? 'selected' : '' %>>Jammu and Kashmir</option>
                                                <option value="Jharkhand" <%= address.state === 'Jharkhand' ? 'selected' : '' %>>Jharkhand</option>
                                                <option value="Karnataka" <%= address.state === 'Karnataka' ? 'selected' : '' %>>Karnataka</option>
                                                <option value="Kerala" <%= address.state === 'Kerala' ? 'selected' : '' %>>Kerala</option>
                                                <option value="Madhya Pradesh" <%= address.state === 'Madhya Pradesh' ? 'selected' : '' %>>Madhya Pradesh</option>
                                                <option value="Maharashtra" <%= address.state === 'Maharashtra' ? 'selected' : '' %>>Maharashtra</option>
                                                <option value="Manipur" <%= address.state === 'Manipur' ? 'selected' : '' %>>Manipur</option>
                                                <option value="Meghalaya" <%= address.state === 'Meghalaya' ? 'selected' : '' %>>Meghalaya</option>
                                                <option value="Mizoram" <%= address.state === 'Mizoram' ? 'selected' : '' %>>Mizoram</option>
                                                <option value="Nagaland" <%= address.state === 'Nagaland' ? 'selected' : '' %>>Nagaland</option>
                                                <option value="Odisha" <%= address.state === 'Odisha' ? 'selected' : '' %>>Odisha</option>
                                                <option value="Punjab" <%= address.state === 'Punjab' ? 'selected' : '' %>>Punjab</option>
                                                <option value="Rajasthan" <%= address.state === 'Rajasthan' ? 'selected' : '' %>>Rajasthan</option>
                                                <option value="Sikkim" <%= address.state === 'Sikkim' ? 'selected' : '' %>>Sikkim</option>
                                                <option value="Tamil Nadu" <%= address.state === 'Tamil Nadu' ? 'selected' : '' %>>Tamil Nadu</option>
                                                <option value="Telangana" <%= address.state === 'Telangana' ? 'selected' : '' %>>Telangana</option>
                                                <option value="Tripura" <%= address.state === 'Tripura' ? 'selected' : '' %>>Tripura</option>
                                                <option value="Uttar Pradesh" <%= address.state === 'Uttar Pradesh' ? 'selected' : '' %>>Uttar Pradesh</option>
                                                <option value="Uttarakhand" <%= address.state === 'Uttarakhand' ? 'selected' : '' %>>Uttarakhand</option>
                                                <option value="West Bengal" <%= address.state === 'West Bengal' ? 'selected' : '' %>>West Bengal</option>
                                            </select>
                                            <div id="error6" class="error-message"></div>
                                        </div>
                                        <div class="col-sm-6">
                                            <label for="pincode">Pincode*</label>
                                            <input type="text" name="pincode" id="pincode" class="form-control" style="width: 90%;">
                                            <div id="error7" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-sm-6">
                                            <label for="alternate_phone">Alternate Phone Number*</label>
                                            <input type="text" name="alternatePhone" id="alternate_phone" class="form-control" style="width: 90%;">
                                            <div id="error8" class="error-message"></div>
                                        </div>
                                        <div class="col-sm-6">
                                            <label for="landmark">Landmark*</label>
                                            <input type="text" name="landmark" id="landmark" class="form-control" style="width: 90%;">
                                            <div id="error9" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-sm-12">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>EDIT ADDRESS</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <% }); %>
            <% } else { %>
                <p>No addresses available.</p>
            <% } %>
        </div><!-- End .col-lg-9 -->
        
        <aside class="col-lg-3">
            <div class="summary">
                <h3 class="summary-title">Your Order</h3><!-- End .summary-title -->
                
               
                <div class="accordion-summary" id="accordion-payment">
                    <!-- Payment methods as before -->
                    <div class="card">
                        <div class="card-header" id="heading-1">
                            <h2 class="card-title">
                                <a role="button" data-toggle="collapse" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
                                    Direct bank transfer
                                </a>
                            </h2>
                        </div><!-- End .card-header -->
                        <div id="collapse-1" class="collapse show" aria-labelledby="heading-1" data-parent="#accordion-payment">
                            <div class="card-body">
                                Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.
                            </div><!-- End .card-body -->
                        </div><!-- End .collapse -->
                    </div><!-- End .card -->
                    
                    <!-- Add other payment methods here -->
                </div><!-- End .accordion -->

                <button type="submit" class="btn btn-outline-primary-2 btn-order btn-block">
                    <span class="btn-text">Place Order</span>
                    <span class="btn-hover-text">Proceed to Checkout</span>
                </button>
            </div><!-- End .summary -->
        </aside><!-- End .col-lg-3 -->
    </div><!-- End .row -->
</form>

	                </div><!-- End .container -->
                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
       
        
        <script>
    $('#form').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal

        // Extract info from data-* attributes
        var name = button.data('name');
        var phone = button.data('phone');
        var locality = button.data('locality');
        var district = button.data('district');
        var address = button.data('address');
        var state = button.data('state');
        var pincode = button.data('pincode');
        var alternatePhone = button.data('alternate-phone');
        var landmark = button.data('landmark');

        // Update the modal's form fields
        var modal = $(this);
        modal.find('#name').val(name);
        modal.find('#phone').val(phone);
        modal.find('#locality').val(locality);
        modal.find('#district').val(district);
        modal.find('#address').val(address);
        modal.find('#state').val(state);
        modal.find('#pincode').val(pincode);
        modal.find('#alternate_phone').val(alternatePhone);
        modal.find('#landmark').val(landmark);
    });
</script>

        </script>
        
        <script>
 document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('editAddressForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const name = document.getElementById('name');
            const phone = document.getElementById('phone');
            const locality = document.getElementById('locality');
            const district = document.getElementById('district');
            const address = document.getElementById('address');
            const state = document.getElementById('state');
            const pincode = document.getElementById('pincode');
            const alternatePhone = document.getElementById('alternate_phone');
            const landmark = document.getElementById('landmark');

            const error1 = document.getElementById('error1');
            const error2 = document.getElementById('error2');
            const error3 = document.getElementById('error3');
            const error4 = document.getElementById('error4');
            const error5 = document.getElementById('error5');
            const error6 = document.getElementById('error6');
            const error7 = document.getElementById('error7');
            const error8 = document.getElementById('error8');
            const error9 = document.getElementById('error9');

            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

            let isValid = true;

            if (name.value.trim() === '') {
                error1.textContent = 'Name is required.';
                error1.style.display = 'block';
                isValid = false;
            }

            if (phone.value.trim() === '') {
                error2.textContent = 'Phone number is required.';
                error2.style.display = 'block';
                isValid = false;
            }

            if (locality.value.trim() === '') {
                error3.textContent = 'Locality is required.';
                error3.style.display = 'block';
                isValid = false;
            }

            if (district.value.trim() === '') {
                error4.textContent = 'District is required.';
                error4.style.display = 'block';
                isValid = false;
            }

            if (address.value.trim() === '') {
                error5.textContent = 'Address is required.';
                error5.style.display = 'block';
                isValid = false;
            }

            if (state.value === '') {
                error6.textContent = 'State is required.';
                error6.style.display = 'block';
                isValid = false;
            }

            if (pincode.value.trim() === '') {
                error7.textContent = 'Pincode is required.';
                error7.style.display = 'block';
                isValid = false;
            }

            if (alternatePhone.value.trim() === '') {
                error8.textContent = 'Alternate phone number is required.';
                error8.style.display = 'block';
                isValid = false;
            }
            if (phone.value.trim() === alternatePhone.value.trim()) {
                error8.textContent = 'Alternate phone number cannot be the same as the primary phone number.';
                error8.style.display = 'block';
                isValid = false;
            }

            if (isValid) {
                event.target.submit(); 
            }
        });
    });
        </script>
        <%- include('../layouts/footer')  %>

</html>
</body>
