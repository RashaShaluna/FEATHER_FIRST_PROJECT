<%- include('../adminlayouts/header') %>

<style>
  input[type="text"],
  input[type="number"],
  textarea {
    width: 75%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }

  .main-panel {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .content-wrapper {
    flex: 1;
  }

  .back-button {
    color: white;
    background-color: #1cc0a0;
    border: none;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
  }

  .back-button:hover {
    background-color: white;
    color: #1cc0a0;
    border: 1px solid #1cc0a0;
  }

  .sub-btn {
    color: white;
    background-color: #1cc0a0;
    border: none;
    border-radius: 5px;
    padding: 10px 20px;
  }

  .sub-btn:hover {
    background-color: white;
    color: #1cc0a0;
    border: 1px solid #1cc0a0;
  }

  .header-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .form-section {
    margin-bottom: 20px;
  }

  .form-label {
    margin-bottom: 10px;
  }
  input[type="file"] {
    width: 400px;       
    padding: 15px;      
    font-size: 12px; 
    border-radius: 5px;  
    border: 1px solid #ccc; 
    background-color: #fdfcfc; 
}

input[type="file"]::-webkit-file-upload-button {
    padding: 5px; 
    font-size: 12px; 
}

input[type="file"]::-ms-browse {
    padding: 5px; 
    font-size: 12px; 
}

input[type="file"]::-webkit-file-upload-text {
    padding: 5px; 
    font-size: 12px; 
}

.error-message{
  color: red;
  font-size: 12px;
}

</style>

<div class="main-panel">
  <div class="content-wrapper">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <div class="mb-3 d-flex justify-content-between">
            <h3 class="card-title fs-5 mb-0">Add Product</h3>
            <a href="/admin/product" class="back-button btn btn-primary float-right">Back to Category</a>
          </div>
          

          <form id="productForm" method="POST" action="/admin/addproduct" enctype="multipart/form-data">
            <div class="row form-section">
              <div class="col-lg-6 mb-4">
                <label for="product_name" class="form-label">Product Name</label>
                <input type="text" placeholder="Type here" name="name" class="form-control border" id="product_name">
                <div id="productName-error" class="error-message" style="display:none; color:red;"></div>
              </div>
              
              <div class="col-lg-4 mb-4">
                <div class="col-lg-6 mb-4 ">
                  <label class="form-label">Category</label>
                <select class="form-select border" style="width: 350px; " name="category" id="category">
                    <option value="">Select Category</option>
                    <% for(let i=0;i<category.length;i++){ %>
                      <option value="<%= category[i]._id %>"><%= category[i].name %></option>
                    <% } %>
                  </select>
                  <div id="category-error" class="error-message"></div>
                </div>
              </div>

            <div class="row form-section">
              <div class="col-lg-4 mb-4">
                <label class="form-label"> Price</label>
                <input placeholder="₹" name="price" type="text" class="form-control border">
                <div id="regularPrice-error" class="error-message"></div>
              </div>
              
              <div class="col-lg-4 mb-4">
                <label class="form-label">Offer Price</label>
                <input placeholder="₹" name="offerprice" type="text" class="form-control border">
                <div id="salePrice-error" class="error-message"></div>
              </div>
              
              <div class="col-lg-4 mb-4">
                <label class="form-label">Quantity</label>
                <input placeholder="" name="quantity" type="number" class="form-control border " id="quantity">
                <div id="quantity-error" class="error-message"></div>
              </div>
            </div>


            <div class="row form-section">
              <label class="form-label">Full Description</label>
              <textarea placeholder="Type here" id="descriptionid" name="description" class="form-control borde  w-50"  rows="4" ></textarea>
              <div id="description-error" class="error-message" style="display:none; color:red;"></div>
            </div>
          
              
              <div class="col-lg-6 mb-4">
                <label class="form-label">Color</label>
                <input name="color" type="text" class="form-control border w-50" id="color">
                <div id="color-error" class="error-message"></div>
              </div>
            </div>

            <!-- <div class="card mb-2">
              <div class="card-header">
                  <h4>Choose images</h4>
              </div>
              <div class="border row">
                  <div id="addedImagesContainer" class="thumbnails-container"></div>
              </div>
           <div class="row">
            <input type="text">
           </div>
           </div> -->

           <div class="row">
            <div class="card-body align-items-center" style="margin-bottom: 20px;">
            <label for="image">Upload Image:</label>
            <input  class="form-control" type="file" id="input1" name="images"  accept="image/png, image/jpeg, image/jpg">
            <div id="images-error" class="error-message"></div>
           </div>
        </div>

        <div class="row">
          <div class="card-body align-items-center" style="margin-bottom: 20px;">
          <label for="image">Upload Image:</label>
          <input  class="form-control" type="file" id="input2" name="images"  accept="image/png, image/jpeg, image/jpg">
          <div id="images-error" class="error-message"></div>
         </div>
      </div>

      <div class="row">
        <div class="card-body align-items-center" style="margin-bottom: 20px;">
        <label for="image">Upload Image:</label>
        <input  class="form-control" type="file" id="input3" name="images"  accept="image/png, image/jpeg, image/jpg">
        <div id="images-error" class="error-message"></div>
       </div>
    </div>

    <div class="row">
      <div class="card-body align-items-center" style="margin-bottom: 20px;">
      <label for="image">Upload Image:</label>
      <input  class="form-control" type="file" id="input4" name="images"  accept="image/png, image/jpeg, image/jpg">
      <div id="images-error" class="error-message"></div>
     </div>
  </div>

            <div class="form-section">
              <% if (typeof message !== 'undefined' && message) { %>
                <div class="alert alert-info msg text-center ">
                    <%= message %>
                </div>
            <% } %>
              <button class="btn btn-md rounded sub-btn" type="submit">Publish</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <%- include('../adminlayouts/footer') %>
</div>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<script>
   

  // validation code
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('productForm');

  // validation
  function nameValidate() {
    const name = document.getElementsByName('name')[0].value.trim();
    const error1 = document.getElementById('productName-error');

    if (name === "") {
      error1.style.display = 'block';
      error1.innerHTML = 'Please enter a product name.';
    } else if (!/^[a-zA-Z\s]+$/.test(name)) {
      error1.style.display = 'block';
      error1.innerHTML = 'Product name should contain only alphabetic characters.';
    } else {
      error1.style.display = 'none';
      error1.innerHTML = '';
    }
  }

  function descriptionValidation() {
    const description = document.getElementById('descriptionid').value.trim();
    const error2 = document.getElementById('description-error');

    if (description === "") {
      error2.style.display = "block";
      error2.innerHTML = "Please enter a description.";
    } else if (description.length < 1) {
      error2.style.display = "block";
      error2.innerHTML = "Description should be at least 50 characters.";
    } else {
      error2.style.display = "none";
      error2.innerHTML = '';
    }
  }

  function priceValidation() {
    const price = document.getElementsByName('price')[0].value.trim();
    const error3 = document.getElementById('regularPrice-error');

    if (price === "") {
      error3.style.display = "block";
      error3.innerHTML = "Please enter a price.";
    } else if (!/^\₹?\d+(\.\d{2})?$/.test(price)) {
      error3.style.display = "block";
      error3.innerHTML = "Invalid price format. Please use ₹XX.XX";
    } else {
      error3.style.display = "none";
      error3.innerHTML = '';
    }
  }

  function offerValidation() {
    const offer = document.getElementsByName('Offerprice')[0].value.trim();
    const error4 = document.getElementById('salePrice-error');

    if (offer === "") {
      error4.style.display = "block";
      error4.innerHTML = "Please enter an offer price.";
    } else if (!/^\₹?\d+(\.\d{2})?$/.test(offer)) {
      error4.style.display = "block";
      error4.innerHTML = "Invalid offer price format. Please use ₹XX.XX";
    } else {
      error4.style.display = "none";
      error4.innerHTML = '';
    }
  }

  function quantityValidation() {
    const quantity = document.getElementById('quantity').value.trim();
    const error5 = document.getElementById('quantity-error');

    if (quantity === "") {
      error5.style.display = 'block';
      error5.innerHTML = 'Please enter the quantity.';
    } else if (!/^\d+$/.test(quantity)) {
      error5.style.display = 'block';
      error5.innerHTML = 'Quantity should be a positive number.';
    } else {
      error5.style.display = 'none';
      error5.innerHTML = '';
    }
  }

  function categoryValidation() {
    const category = document.getElementById('category').value;
    const error6 = document.getElementById('category-error');

    if (category === "") {
      error6.style.display = 'block';
      error6.innerHTML = 'Please select a category.';
    } else {
      error6.style.display = 'none';
      error6.innerHTML = '';
    }
  }

  function colorValidation() {
    const color = document.getElementById('color').value.trim();
    const error7 = document.getElementById('color-error');

    if (color === "") {
      error7.style.display = 'block';
      error7.innerHTML = 'Please enter a color.';
    } else {
      error7.style.display = 'none';
      error7.innerHTML = '';
    }
  }
  function validateImages() {
    const imageInputs = document.querySelectorAll('input[type="file"][name="images"]');
    let isValid = true;
    
    imageInputs.forEach((input, index) => {
      const imageErrorElement = document.getElementById(`images-error`);
      
      if (input.files.length === 0) {
        imageErrorElement.style.display = 'block';
        imageErrorElement.innerHTML = 'Please select an images.';
        isValid = false;
      } else {
        imageErrorElement.style.display = 'none';
        imageErrorElement.innerHTML = '';
      }
    });
    
    return isValid;
  }



  
  form.addEventListener('submit', (e) => {
    nameValidate();
    descriptionValidation();
    priceValidation();
    offerValidation();
    quantityValidation();
    categoryValidation();
    colorValidation();
    const imagesValid = validateImages();

    // Prevent form submission if there are errors
    if (document.getElementById('productName-error').style.display === 'block' || 
        document.getElementById('description-error').style.display === 'block' ||
        document.getElementById('regularPrice-error').style.display === 'block' ||
        document.getElementById('salePrice-error').style.display === 'block' ||
        document.getElementById('quantity-error').style.display === 'block' ||
        document.getElementById('category-error').style.display === 'block' ||
        document.getElementById('color-error').style.display === 'block'||
        !imagesValid) {
      e.preventDefault();
    }
  });
});

</script>